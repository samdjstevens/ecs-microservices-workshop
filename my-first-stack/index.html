<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/ecs-microservices-workshop/blog/rss.xml" title="ECS Microservices with CDK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ecs-microservices-workshop/blog/atom.xml" title="ECS Microservices with CDK Blog Atom Feed"><title data-react-helmet="true">My First Stack | ECS Microservices with CDK</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="My First Stack | ECS Microservices with CDK"><meta data-react-helmet="true" name="description" content="Let&#x27;s dive right in and create our first CDK stack. In the following steps, we will use CDK to provision an EC2 instance, make some changes to it, and retrieve some information about it, all as Infrastructure-as-Code."><meta data-react-helmet="true" property="og:description" content="Let&#x27;s dive right in and create our first CDK stack. In the following steps, we will use CDK to provision an EC2 instance, make some changes to it, and retrieve some information about it, all as Infrastructure-as-Code."><meta data-react-helmet="true" property="og:url" content="https://samdjstevens.github.io/ecs-microservices-workshop/my-first-stack"><link data-react-helmet="true" rel="shortcut icon" href="/ecs-microservices-workshop/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://samdjstevens.github.io/ecs-microservices-workshop/my-first-stack"><link rel="stylesheet" href="/ecs-microservices-workshop/styles.9f51c6d8.css">
<link rel="preload" href="/ecs-microservices-workshop/styles.a6c8041f.js" as="script">
<link rel="preload" href="/ecs-microservices-workshop/runtime~main.7c32ec80.js" as="script">
<link rel="preload" href="/ecs-microservices-workshop/main.b5e63978.js" as="script">
<link rel="preload" href="/ecs-microservices-workshop/1.ec59d230.js" as="script">
<link rel="preload" href="/ecs-microservices-workshop/18.1fb82cf0.js" as="script">
<link rel="preload" href="/ecs-microservices-workshop/935f2afb.e16a6d9b.js" as="script">
<link rel="preload" href="/ecs-microservices-workshop/17.3d9f3906.js" as="script">
<link rel="preload" href="/ecs-microservices-workshop/7f50b1cd.15f6af84.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/ecs-microservices-workshop/"><img src="/ecs-microservices-workshop/img/cdk-logo.png" alt="ECS Microservices with CDK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/ecs-microservices-workshop/img/cdk-logo.png" alt="ECS Microservices with CDK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">ECS Microservices with CDK</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/samdjstevens/ecs-microservices-workshop" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">View on GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/ecs-microservices-workshop/"><img src="/ecs-microservices-workshop/img/cdk-logo.png" alt="ECS Microservices with CDK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/ecs-microservices-workshop/img/cdk-logo.png" alt="ECS Microservices with CDK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">ECS Microservices with CDK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/samdjstevens/ecs-microservices-workshop" target="_blank" rel="noopener noreferrer" class="menu__link">View on GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/introduction">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/ecs-microservices-workshop/my-first-stack">My First Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/project-description">Translatr app</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/creating-the-vpc">Creating the VPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/cluster">Creating the Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/adding-a-service">Adding a Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/discovering-services">Discovering services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/frontend-service">Adding the frontend service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/writing-constructs">Writing constructs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/testing">Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ecs-microservices-workshop/conclusion">Conclusion</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">My First Stack</h1></header><div class="markdown"><p>Let&#x27;s dive right in and create our first CDK stack. In the following steps, we will use CDK to provision an EC2 instance, make some changes to it, and retrieve some information about it, all as Infrastructure-as-Code.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-the-stack"></a>Creating the stack<a class="hash-link" href="#creating-the-stack" title="Direct link to heading">#</a></h2><p>To start creating your first CDK stack, create a new directory and move inside it by running the following command in the CLI:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> my-first-stack </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> my-first-stack</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Next, initialise the CDK project with the following command:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cdk init app --language typescript</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In a new terminal window, inside the same directory, run:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run </span><span class="token function" style="color:rgb(130, 170, 255)">watch</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will start watching the project files for any changes and re-compile the typescript:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain">:51:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Starting compilation </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">watch</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain">:51:06</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Found </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> errors. Watching </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> changes.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Your workspace is now ready to start exploring your stack.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="exploring-the-project"></a>Exploring the project<a class="hash-link" href="#exploring-the-project" title="Direct link to heading">#</a></h3><p>Open up the directory in your editor and take a look at the <code>lib/my-first-stack-stack.ts</code> file:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">as</span><span class="token plain"> cdk </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@aws-cdk/core&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyFirstStackStack</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">cdk</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Stack</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">scope</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> cdk</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token parameter">Construct</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> id</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> string</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> props</span><span class="token parameter operator" style="color:rgb(137, 221, 255)">?</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> cdk</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token parameter">StackProps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The code that defines your stack goes here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This is where the stack for your CDK project is defined. In here you will place the code which describes the AWS resources you want to deploy as part of your stack.</p><p>Take a look at the <code>bin/my-first-stack.ts</code> file also:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token shebang important">#!/usr/bin/env node</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;source-map-support/register&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">import</span><span class="token plain"> * as cdk from </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@aws-cdk/core&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> MyFirstStackStack </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> from </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;../lib/my-first-stack-stack&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">const app </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> new cdk.App</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">new MyFirstStackStack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">app, </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MyFirstStackStack&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This is the entrypoint for your CDK project, and loads/executes the stack described in <code>lib/my-first-stack-stack.ts</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-an-ec2-instance"></a>Creating an EC2 instance<a class="hash-link" href="#creating-an-ec2-instance" title="Direct link to heading">#</a></h2><p>Let&#x27;s create an EC2 instance with CDK. First we need to add the <code>@aws-cdk/aws-ec2</code> dependency to our stack to bring in all the CDK constructs associated with EC2.</p><p>Stop the <code>npm run watch</code> command and run the following command: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> @aws-cdk/aws-ec2 --save </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run </span><span class="token function" style="color:rgb(130, 170, 255)">watch</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now add the highlighted lines below to the stack in <code>lib/my-first-stack-stack.ts</code>:</p><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">lib/my-first-stack-stack.ts</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">as</span><span class="token plain"> cdk </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@aws-cdk/core&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">as</span><span class="token plain"> ec2 </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@aws-cdk/aws-ec2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyFirstStackStack</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">cdk</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Stack</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">scope</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> cdk</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token parameter">Construct</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> id</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> string</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> props</span><span class="token parameter operator" style="color:rgb(137, 221, 255)">?</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> cdk</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token parameter">StackProps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The code that defines your stack goes here</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> vpc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ec2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Vpc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">fromLookup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DefaultVPC&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      isDefault</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> server </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ec2</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MyInstance&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      vpc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      instanceType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ec2</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">InstanceType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t3.nano&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      machineImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ec2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">MachineImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">latestAmazonLinux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="setting-the-account-and-region-for-the-stack"></a>Setting the account and region for the stack<a class="hash-link" href="#setting-the-account-and-region-for-the-stack" title="Direct link to heading">#</a></h3><p>For this particular stack, we need to tell CDK which AWS account and region we are deploying to. Open up the <code>bin/my-first-stack.ts</code> file and make the changes highlighted below, replacing the placeholders with your AWS account ID and region which you wish to deploy to.</p><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">bin/my-first-stack.ts</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token shebang important">#!/usr/bin/env node</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;source-map-support/register&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">import</span><span class="token plain"> * as cdk from </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@aws-cdk/core&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> MyFirstStackStack </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> from </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;../lib/my-first-stack-stack&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">const app </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> new cdk.App</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">const </span><span class="token function" style="color:rgb(130, 170, 255)">env</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> account: </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;[YOUR-ACCOUNT-ID-HERE]&#x27;</span><span class="token plain">, region: </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;[YOUR-PREFERRED-REGION-HERE]&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">new MyFirstStackStack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">app, </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MyFirstStackStack&#x27;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">env</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Why do we need to do this?</h5></div><div class="admonition-content"><p>The stack says to deploy an EC2 instance into the <em>default VPC</em>, but what VPC is this? To find out, CDK needs to perform a lookup to grab the details of the VPC - and to do this, it must know the AWS account and region in which to look in.</p></div></div><p>Run <code>cdk deploy</code> to start the deployment of the stack. You will get something like below.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">This deployment will make potentially sensitive changes according to your current security approval level (--require-approval broadening).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Please confirm you intend to make the following modifications:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">IAM Statement Changes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌───┬────────────────────────────────┬────────┬────────────────┬───────────────────────────────┬───────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│   │ Resource                       │ Effect │ Action         │ Principal                     │ Condition │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├───┼────────────────────────────────┼────────┼────────────────┼───────────────────────────────┼───────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ + │ ${MyInstance/InstanceRole.Arn} │ Allow  │ sts:AssumeRole │ Service:ec2.${AWS::URLSuffix} │           │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└───┴────────────────────────────────┴────────┴────────────────┴───────────────────────────────┴───────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Security Group Changes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌───┬─────────────────────────────────────────────┬─────┬────────────┬─────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│   │ Group                                       │ Dir │ Protocol   │ Peer            │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├───┼─────────────────────────────────────────────┼─────┼────────────┼─────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ + │ ${MyInstance/InstanceSecurityGroup.GroupId} │ Out │ Everything │ Everyone (IPv4) │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└───┴─────────────────────────────────────────────┴─────┴────────────┴─────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(NOTE: There may be security-related changes not in this list. See https://github.com/aws/aws-cdk/issues/1299)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This is CDK letting you know what security-impacting changes the deploy will make, including IAM statement/policy and Security Group changes. </p><p>Enter <code>y</code> to accept the changes and continue. This may take a few minutes, but once done you should see something like the below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">MyFirstStackStack: deploying</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MyFirstStackStack: creating CloudFormation changeset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ✅  MyFirstStackStack</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Stack ARN:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">arn:aws:cloudformation:eu-west-1:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">account-id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">:stack/MyFirstStackStack/a70c6020-709b-11eb-9b63-06c31b364fbd</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="making-some-changes"></a>Making some changes<a class="hash-link" href="#making-some-changes" title="Direct link to heading">#</a></h2><p>After launching the instance we realise that we actually wanted a <code>t3.small</code> instance type. Update the type of the instance like so below:</p><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">lib/my-first-stack-stack.ts</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> server </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ec2</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MyInstance&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  vpc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  instanceType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ec2</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">InstanceType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t3.small&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  machineImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ec2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">MachineImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">latestAmazonLinux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>We also want to know the public DNS name of the instance without having to go into the EC2 console and looking it up. Add the highlighted lines below to have the DNS name be outputted in the CLI after the stack is updated:</p><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">lib/my-first-stack-stack.ts</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> server </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ec2</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MyInstance&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  vpc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  instanceType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ec2</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">InstanceType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t3.small&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  machineImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ec2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">MachineImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">latestAmazonLinux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">cdk</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">CfnOutput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ServerDNSNameOutput&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">instancePublicDnsName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  exportName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ServerDNSName&#x27;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Run <code>cdk diff</code> to see what changes are going to be deployed:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Stack MyFirstStackStack</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Resources</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> AWS::EC2::Instance MyInstance MyInstanceA12EC128 may be replaced</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> └─ </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">~</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> InstanceType </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">may cause replacement</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ├─ </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> t3.nano</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     └─ </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">+</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> t3.small</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Outputs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">+</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Output ServerDNSNameOutput ServerDNSNameOutput: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Value&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Fn::GetAtt&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MyInstanceA12EC128&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;PublicDnsName&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Export&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ServerDNSName&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that the message says that the instance <strong>may be replaced</strong>. More on this below.</p><p>Run <code>cdk deploy</code> to start the update of the deployed stack. Once it has completed deploying, you will see that the DNS name of the instance (which is a <code>t3.small</code>) is printed out.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ✅  MyFirstStackStack</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Outputs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MyFirstStackStack.ServerDNSNameOutput = ec2-18-203-102-161.eu-west-1.compute.amazonaws.com</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Why was the first instance deleted and a new one created?</h5></div><div class="admonition-content"><p>You cannot change the instance type of an EC2 instance once it has been launched - to resize it you must launch another instance. CDK is aware of this and takes care of removing the old instance and creating the new one for you.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="destroying-the-stack"></a>Destroying the stack<a class="hash-link" href="#destroying-the-stack" title="Direct link to heading">#</a></h2><p>Once we&#x27;re finished with the server and no longer need it, we want to terminate it so that we aren&#x27;t being charged for it being up.</p><p>To <strong>destroy every resource that the stack has created</strong>, run <code>cdk destroy</code> from the CLI. You will be asked if you are sure you want to destroy the stack:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Are you sure you want to delete: MyFirstStackStack </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y/n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">?</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Type <code>y</code> and press enter to confirm, and then wait whilst the stack is torn down. Once the process is finished, the EC2 instance will have been terminated.</p><p>Now that you have successfully created and destroyed your first stack, we are ready to begin working on our real application&#x27;s stack.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/samdjstevens/ecs-microservices-workshop/edit/master/docs/first-stack.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ecs-microservices-workshop/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ecs-microservices-workshop/project-description"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Translatr »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-the-stack" class="table-of-contents__link">Creating the stack</a><ul><li><a href="#exploring-the-project" class="table-of-contents__link">Exploring the project</a></li></ul></li><li><a href="#creating-an-ec2-instance" class="table-of-contents__link">Creating an EC2 instance</a><ul><li><a href="#setting-the-account-and-region-for-the-stack" class="table-of-contents__link">Setting the account and region for the stack</a></li></ul></li><li><a href="#making-some-changes" class="table-of-contents__link">Making some changes</a></li><li><a href="#destroying-the-stack" class="table-of-contents__link">Destroying the stack</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Built with Docusaurus.</div></div></div></footer></div>
<script src="/ecs-microservices-workshop/styles.a6c8041f.js"></script>
<script src="/ecs-microservices-workshop/runtime~main.7c32ec80.js"></script>
<script src="/ecs-microservices-workshop/main.b5e63978.js"></script>
<script src="/ecs-microservices-workshop/1.ec59d230.js"></script>
<script src="/ecs-microservices-workshop/18.1fb82cf0.js"></script>
<script src="/ecs-microservices-workshop/935f2afb.e16a6d9b.js"></script>
<script src="/ecs-microservices-workshop/17.3d9f3906.js"></script>
<script src="/ecs-microservices-workshop/7f50b1cd.15f6af84.js"></script>
</body>
</html>